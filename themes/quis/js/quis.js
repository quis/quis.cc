var QUIS=function(a){a.focus=false;a.imageSelector="img:not(.static)";a.isMobile=!!navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad|symbian|android|palm|blackberry)/gi);a.$body=$("body");a.$page=$("html, body");a.$window=$(window);a.$document=$(document);return a}(QUIS||{});$(function(){$(QUIS.imageSelector).imageScale();for(var a in QUIS)QUIS[a].init&&QUIS[a].init();QUIS.isMobile||$(".next-link").hide();$("#photos").infinitescroll({navSelector:"footer",nextSelector:".next-link a",itemSelector:".unit",loadingText:"Loading more photos",donetext:"No more photos",callback:function(a,b){$("#"+b+" "+QUIS.imageSelector).imageScale();QUIS.map.renderMap();_gaq&&_gaq.push(["_trackPageview",a])}});$(document).keydown(function(a){switch(a.keyCode||a.which){case 74:case 40:return scrollPhotos.go(1);
case 75:case 38:return scrollPhotos.go(-1)}})});$.expr[":"].data=function(a,c,b){c=b[3].split(", ");return a.dataset[c[0]]==c[1]};var imageScaleTools=function(){return{selectors:{},cached:function(){$.each(imageScaleTools.selectors,function(){this.$collection.imageScale(this.options)})},images:function(){},live:function(a){var c,b,f=$(".hasTooltip").width(),e=window.innerHeight?window.innerHeight:$(window).height(),d=$(this),a=$.extend({},{scale:{x:1,y:0.9},attr:{x:"data-width",y:"data-height"},speed:100,updateCache:true},a);c=parseInt(f*a.scale.x,10);b=parseInt(e*a.scale.y,10);if(QUIS.orientation==90||QUIS.orientation==-90)f=
c,c=b,b=f,f=null;if(a.updateCache)a.updateCache=false,imageScaleTools.selectors[d.selector]={$collection:d,options:a};return this.each(function(){var f=$(this),e=f.attr(a.attr.x),d=f.attr(a.attr.y),i=c/(e/d);f.css(e>c||d>b?{width:i>b?"auto":c,height:i>b?b:"auto"}:{width:"auto",height:"auto"})})}}}();jQuery.fn.imageScale=imageScaleTools.live;$(function(){$(window).resize(imageScaleTools.cached);window.onorientationchange=function(){QUIS.orientation=window.orientation;imageScaleTools.cached()}});(function(a){function c(){var a=QUIS.$document.height();return QUIS.$window.scrollTop()+QUIS.$window.height()*4>a}function b(b,e,d){var g=scrollPages.nearest();try{window.history.replaceState({fragment:""},"",1===g?b:b+"page/"+scrollPages.nearest())}catch(k){}if(!d.isDuringAjax&&!d.isInvalidPage&&!d.isDone&&c()&&!QUIS.isMobile){d.isDuringAjax=true;d.currPage++;d.loadingMsg.appendTo(e.contentSelector).show();var j=b+"page/"+d.currPage+"/?mode=AJAX",i="infscr-page-"+d.currPage,b=b+"page/"+d.currPage+
"/";a("<div/>").attr("id",i).attr("class","infscr-pages").appendTo(e.contentSelector).load(b+" "+e.itemSelector,null,function(){d.loadingMsg.delay(600).fadeOut("fast",function(){a(this).remove()});d.isDone&&a("footer nav").fadeIn("slow");e.callback.apply(this,[j,i]);d.isDuringAjax=false})}}a.fn.infinitescroll=function(c){if(QUIS.isMobile)return this;var e=a.extend({},a.fn.infinitescroll.defaults,c),d=a.fn.infinitescroll,g=a(e.nextSelector).attr("href")||"invalid";if(null===g.match("page"))return this;
g=g.split("page");d.currPage=g[1].replace(/\//gi,"")-1;g=g[0];e.contentSelector=e.contentSelector||this;a.fn.infinitescroll.loadingMsg=a('<div id="infscr-loading" />');QUIS.$document.ajaxError(function(a,b){if(404==b.status)d.isDone=true});QUIS.rateLimit.queue(function(){b(g,e,d)});return this};a.extend(a.fn.infinitescroll,{defaults:{debug:false,nextSelector:"",loadingText:"",donetext:"",navSelector:"",contentSelector:null,itemSelector:"",callback:function(){},offset:1200},currPage:1,currDOMChunk:null,
isDuringAjax:false,isInvalidPage:false,isDone:false})})(jQuery);(function(a){a.belowthefold=function(c,b){return a(window).height()+a(window).scrollTop()<=a(c).offset().top-b.threshold};a.abovethefold=function(c,b){return a(window).height()+a(window).scrollTop()>=a(c).offset().top-b.threshold};a.abovethetop=function(c,b){return a(window).scrollTop()>=a(c).offset().top+a(c).innerHeight()-b.threshold};a.rightofscreen=function(c,b){return a(window).width()+a(window).scrollLeft()<=a(c).offset().left-b.threshold};a.leftofscreen=function(c,b){return a(window).scrollLeft()>=
a(c).offset().left+a(c).width()-b.threshold};a.inviewport=function(c,b){return!a.rightofscreen(c,b)&&!a.leftofscreen(c,b)&&!a.belowthefold(c,b)&&!a.abovethetop(c,b)};a.extend(a.expr[":"],{"below-the-fold":function(c){return a.belowthefold(c,{threshold:0})},"above-the-fold":function(c){return a.abovethefold(c,{threshold:0})},"above-the-top":function(c){return a.abovethetop(c,{threshold:0})},"left-of-screen":function(c){return a.leftofscreen(c,{threshold:0})},"right-of-screen":function(c){return a.rightofscreen(c,
{threshold:0})},"in-viewport":function(c){return a.inviewport(c,{threshold:0})}})})(jQuery);QUIS=function(a){var c=[{featureType:"administrative",elementType:"all",stylers:[{visibility:"on"},{saturation:-100},{lightness:20}]},{featureType:"road",elementType:"all",stylers:[{visibility:"on"},{saturation:-100},{lightness:40}]},{featureType:"water",elementType:"all",stylers:[{visibility:"on"},{saturation:-10},{lightness:30}]},{featureType:"landscape.man_made",elementType:"all",stylers:[{visibility:"simplified"},{saturation:-60},{lightness:10}]},{featureType:"landscape.natural",elementType:"all",
stylers:[{visibility:"simplified"},{saturation:-60},{lightness:60}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"},{saturation:-100},{lightness:60}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"},{saturation:-100},{lightness:60}]}],b,f,e=false,d=$([]),g,k=true,j,i=function(){e=true;j=new google.maps.LatLngBounds;b=[];f=[];$("#map-wrapper").remove();$("body").prepend("<div id='map-wrapper' class='map'><div id='map-canvas'></div></div>");$(".blogPost").each(function(){$(this).find(".onMap").length&&
$(this).addClass("hasMap")});d=$("#map-canvas");g=new google.maps.Map(d.get(0),{center:new google.maps.LatLng(48.7574884,5.5816387),zoom:6,mapTypeId:google.maps.MapTypeId.TERRAIN,mapTypeControl:false,disableDoubleClickZoom:true,draggable:false,scrollwheel:false,panControl:false,rotateControl:false,scaleControl:false,streetViewControl:false,zoomControl:false,styles:c});$(".onMap").each(function(a){var c=0,e=google.maps.geometry.encoding.decodePath($(this).data("route-to"));$(this).attr("data-index",
a);for(b.push({numberOfPoints:e.length,points:e,lastProgress:0,pointsUsed:0});c<e.length;c++)j.extend(e[c]);f.push(new google.maps.Polyline({strokeWeight:2,strokeColor:"#f82858",strokeOpacity:0.7,icons:[{icon:{path:google.maps.SymbolPath.CIRCLE,scale:4,strokeColor:"#ffffff",strokeOpacity:1,fillColor:"#f82858",fillOpacity:0.7,strokeWeight:3},offset:"100%"}],map:g}))});g.fitBounds(j);e=false;k&&(m(),a.rateLimit.queue(m),k=false);n()},m=function(){var a=$(".onMap"),c=a.filter(":above-the-fold").last().data("index"),
d,g,h,i,k=QUIS.$window.height(),j=QUIS.$body.scrollTop(),l;if(!e){e=true;for(h=0;h<f.length;h++){g=0===h?0:k;i=0===h?k:0;d=a.filter("[data-index="+h+"]");d=(j+g-d.offset().top)/(parseInt(d.css("padding-top"),10)-i);d=d<0?0:d;d=d>1?1:d;g=f[h].get("icons")[0];g.icon.fillOpacity=h===c?0.4:0;g.icon.strokeOpacity=h===c?0.9:0;g.offset=b[h].pointsUsed<b[h].numberOfPoints?"100%":d*100+"%";f[h].set("icons",[g]);if(h>c){e=false;break}i=Math.round(b[h].numberOfPoints*d);l=b[h].points.slice(b[h].lastProgress,
i);g=l.length?f[h].getPath():null;for(d=0;d<l.length;d++){if(i<b[h].lastProgress){e=false;break}g.push(l[d]);b[h].pointsUsed++}if(i>b[h].lastProgress)b[h].lastProgress=i}e=false}},n=function(){var a=!!$(".blogPost:above-the-fold").last().find(".onMap").length,c=$("#map-wrapper"),b=c.is(":visible");b&&!a&&c.hide();!b&&a&&c.show()};a.map={init:function(){google.maps.event.addDomListener(window,"load",i)},renderMap:i};return a}(QUIS||{});QUIS=function(a){var c=function(){d&&(d=false,clearTimeout(f),f=setTimeout(b,25))},b=function(){d=true;for(var a in e)e[a]()},f,e=[],d=true;a.rateLimit={init:function(){QUIS.$window.on("scroll touchmove",c)},queue:function(){var a=Array.prototype.slice.call(arguments),c;for(c in a)e.push(a[c])}};return a}(QUIS||{});var scrollPages=function(){var a={nearestNumber:function(a,b){if((f=a.length)<2)return f-1;for(var f,e=Math.abs(a[--f]-b);f--;)if(e<(e=Math.abs(a[f]-b)))break;return f+1}};return{nearest:function(){var c=$(".infscr-pages"),b=[0];if(c.length<1)return 1;c.each(function(a){b[a+1]=parseInt($(this).offset().top,10)});return a.nearestNumber(b,parseInt(QUIS.$document.scrollTop(),10))+1}}}();var scrollPhotos=function(){var a={to:function(c,b){a.inProgress=true;QUIS.$page.animate({scrollTop:c},b,function(){a.inProgress=false});QUIS.$window.trigger("scroll");return false},nearestNumber:function(a,b){if((f=a.length)<2)return f-1;for(var f,e=Math.abs(a[--f]-b);f--;)if(e<(e=Math.abs(a[f]-b)))break;return f+1},go:function(){var c=parseInt(QUIS.$document.scrollTop(),10),b=scrollPhotos.nearest(0).offset(),f=scrollPhotos.nearest(a.direction).offset();return c<250&&-1==a.direction?a.to(0,a.time/
2):c<150&&1==a.direction?a.to(b.top-a.topMargin,a.time/2):a.to(f.top-a.topMargin,a.time)},inProgress:false,direction:null,time:200,topMargin:18};return{go:function b(f){a.direction=f;if(a.inProgress)return setTimeout(b,100),false;a.go()},nearest:function(b){var f=$("img"),e=[];f.each(function(a){e[a]=parseInt($(this).offset().top,10)});return f.eq(a.nearestNumber(e,parseInt(QUIS.$document.scrollTop(),10))+b)}}}();
